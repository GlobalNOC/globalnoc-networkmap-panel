{"version":3,"sources":["atlas3.js"],"names":["_","$","MetricsPanelCtrl","appEvents","LeafletMap","Scale","CustomHover","panelDefaults","map_tile_url","data","lat","lng","zoom","choices","name","mapSrc","max","min","size","layers","hide_layers","twin_tubes","arrows","weather_tile","static_node_tooltip","nodeFillColor","downLinkColor","color","mode","colorScale","cardColor","exponent","colorScheme","fillBackground","legend","show","legend_colors","opacity","thresholds","tooltip","showLinkHover","showNodeHover","content","node_content","layer","criteria","link","selected","node","to_si","legendTypes","opacityScales","threshold_colors","tempArray","Atlas3","$scope","$injector","defaults","panel","map_holder_id","id","containerDivId","recentData","map_drawn","layer_ids","show_legend","t_colors","rgb_values","hex_values","json_index","json_content","custom_hover","scale","colorSchemes","getColorSchemes","events","on","onDataReceived","bind","onDataError","onInitEditMode","onInitPanelActions","onDefaultNodeColor","onDownLinkChange","onOpacityLegendColor","dataList","render","process_data","self","data_targets","map","target","forEach","active","topology","undefined","links","endpoints","l","ep","includes","toggle","dir","target_endpoints","pop","push","endpoint","label","target_links","str","full","cur","sum","count","avg","interval","i","datapoints","length","value","start","end","obj","layer_max","layer_min","color_criteria","e","toFixed","color_value","popColor","popOpacity","getColor","endpointColor","endpointOpacity","getOpacity","getThresholdColor","lineColor","lineOpacity","az","azLineColor","azLineOpacity","toSI","now","arrow","za","zaLineColor","zaLineOpacity","update","num","err","dataRaw","addEditorTab","displayColor","actions","index","setDownLinkColor","console","log","threshold","idx","modalScope","$new","emit","src","scope","jsonModal","json","json_obj","JSON","parse","stringify","splice","remove","colors","invert","reverse","options","legendWidth","getOpacityScale","arr","original","toString","sort","a","b","getThresholdScale","htmlContent","parseHtml","elem","attrs","ctrl","firstRender","renderingCompleted","window","onbeforeunload","setTimeout","adjLoadLegend","horizontal","html_content","getHtml","displayOpacity","width","card_color","display","isSorted","displayThresholds","drawLegend","validateSize","use_image","latlng","setMapUrl","panTo","setImageUrl","image_url","toggleWeatherTile","all_layers","removeLayers","j","networkLayer","addNetworkLayer","lineWidth","mapSource","layerId","onInitComplete","isJson","document","getElementById","containerId","bing_api_key","image","templateUrl"],"mappings":"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","file":"atlas3.js","sourcesContent":["/*\nCopyright 2018 The Trustees of Indiana University\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n\nimport './css/atlas3_leafletmap.css!';\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport {appEvents} from 'app/core/core';\nimport LeafletMap from './js/atlas3_leafletmap.js';\nimport {Scale} from './scale';\nimport {CustomHover} from './CustomHover';\n\nconst panelDefaults = {\n    map_tile_url: \"http://api.tiles.mapbox.com/v4/mapbox.dark/{z}/{x}/{y}.png?access_token=\",\n    data: [],\n    lat: 33,\n    lng: -80,\n    zoom: 3,\n    choices: [],\n    name: [],\n    mapSrc: [],\n    max: [],\n    min: [],\n    size: [],\n    layers: [],\n    hide_layers: false,\n    twin_tubes: false,\n    arrows: false,\n    weather_tile: false,\n    static_node_tooltip: false,\n    nodeFillColor: \"rgb(200,200,200)\",\n    downLinkColor: \"rgb(200,200,200)\",\n    color: {\n        mode: 'spectrum',\n        colorScale: 'linear',\n        cardColor: '#2f575e',\n        exponent: 0.5,\n        colorScheme: 'interpolateOranges',\n        fillBackground: false\n    },\n    legend: {\n        show: true,\n        mode: 'spectrum',\n        legend_colors: [],\n        opacity: [],\n        thresholds: [\"50\"]\n    },\n    tooltip:{\n        show: true,\n        showLinkHover: false,\n        showNodeHover: false,\n        content: ' ',\n        node_content: ' '\n    },\n    layer: {\n        criteria: ['Minimum', 'Maximum', 'Average', 'Current'],\n        link: { selected: 'Current' },\n        node: { selected: 'Current' }\n    },\n    to_si: 1000000000,\n    legendTypes: ['opacity','spectrum','threshold'],\n    opacityScales: ['linear', 'sqrt'],\n    colorScheme : 'interpolateRdYlGn',\n    threshold_colors: ['#37872D', '#C4162A']\n};\n\nvar tempArray=[];\n\nexport class Atlas3 extends MetricsPanelCtrl {\n    constructor($scope, $injector) {\n        super($scope, $injector);\n        _.defaults(this.panel, panelDefaults);\n        this.map_holder_id = 'map_' + this.panel.id;\n        this.containerDivId = 'container_'+this.map_holder_id;\n        this.recentData = [];\n        this.map_drawn = false;\n        this.layer_ids = [];\n        this.show_legend = true;\n        this.opacity = [];\n        this.t_colors = [];\n        this.rgb_values = [];\n        this.hex_values = [];\n        this.json_index = null;\n        this.json_content = '';\n        this.custom_hover = new CustomHover();\n        this.scale = new Scale($scope,this.panel.colorScheme);\n        this.colorSchemes=this.scale.getColorSchemes();\n        this.events.on('data-received', this.onDataReceived.bind(this));\n        this.events.on('data-error', this.onDataError.bind(this));\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n        this.events.on('init-panel-actions', this.onInitPanelActions.bind(this));\n\n        // Color picker event handlers\n        this.onDefaultNodeColor = this.onDefaultNodeColor.bind(this);\n        this.onDownLinkChange = this.onDownLinkChange.bind(this);\n        this.onOpacityLegendColor = this.onOpacityLegendColor.bind(this);\n    }\n\n    onDataReceived(dataList) {\n        if(!this.map_drawn){\n            this.recentData = dataList;\n            this.render();\n        }\n\n        this.recentData = dataList;\n        this.process_data(dataList);\n    }\n\n    process_data(dataList){\n        var self = this;\n\t    var data_targets = dataList.map(target => target.target);\n        //update with the data!\n        _.forEach(dataList, function(data){\n            _.forEach(self.panel.layers, function(layer){\n                //find the link associated with this data\n                if(typeof layer.active !== \"function\"){\n                    return;\n                }\n\n                if(layer.topology() === undefined){\n                    return;\n                }\n\n                var links = layer.topology().links();\n                var endpoints = layer.topology().endpoints();\n\n                // Hide layers without data\n                if(self.panel.hide_layers){\n                    _.forEach(links, function(l){\n                        _.forEach(l.endpoints, function(ep){\n                            if(!data_targets.includes(ep.name)){\n                                layer.toggle(false);\n                            }\n                        });\n                    });\n                }\n                var target;\n                var dir;\n\n                // Match endpoints to visualize the data\n                var target_endpoints = [];\n                if(endpoints) {\n                    _.forEach(endpoints, function(pop){\n                        if(data.target == pop.name){\n                            target_endpoints.push({endpoint: pop, name: pop.name, label: pop.label});\n                        }\n                    });\n                }\n\n\n                // Match links to visualize the data\n                var target_links = [];\n                if(links){\n                    _.forEach(links, function(l){\n                        _.forEach(l.endpoints, function(ep){\n                            var str =  l.name + \" \" + ep.name;\n                            if(data.target == ep.name){\n                                if(ep.label){\n                                    target_links.push({link: l, endpoint: ep.name, label: ep.label, full: str});\n                                }else{\n                                    target_links.push({link: l, endpoint: ep.name, label: null, full: str});\n                                }\n                            }\n                        });\n                    });\n                }\n                var cur;\n                var min;\n                var max;\n                var sum = 0;\n                var count = 0;\n                var avg;\n                var interval;\n\n                //find the last valid value i.e. the current value\n                //find the min\n                //find the max\n                //find the average\n                //find the total datapoints\n                for (var i = (data.datapoints.length - 1); i >= 0; i--){\n                    var value = data.datapoints[i][0];\n                    if(value !== undefined && value !== null){\n                        sum += value;\n                        count += 1;\n                        if(min === undefined){\n                            min = value;\n                            max = value;\n                        }\n                        if(value < min){\n                            min = value;\n                        }\n                        if(value > max){\n                            max = value;\n                        }\n\n                        if(cur === undefined){\n                            cur = value;\n                        }\n                    }\n                }\n\n                if(count > 1){\n                    var start = data.datapoints[0][1];\n                    var end = data.datapoints[1][1];\n                    interval = start - end;\n                }\n\n                // if target_endpoints is not empty, visualize the data\n                if(target_endpoints.length > 0){\n                    _.forEach(target_endpoints, function(obj){\n                        let layer_max = layer.max();\n                        let layer_min = layer.min();\n                        let color_criteria = self.panel.layer.node.selected;\n                        var e = obj.endpoint;\n                        e.cur = cur;\n                        e.min = min;\n                        e.max = max;\n                        e.sum = sum;\n                        e.count = count;\n                        avg = sum/count;\n                        e.avg = avg.toFixed(2);\n                        let color_value;\n                        if(color_criteria === \"Average\"){\n                            color_value = ((avg - layer_min) / (layer_max-layer_min)) * 100;\n                        } else if(color_criteria === \"Minimum\") {\n                            color_value = ((min - layer_min) / (layer_max-layer_min)) * 100;\n                        } else if(color_criteria === \"Maximum\") {\n                            color_value = ((max - layer_min) / (layer_max-layer_min)) * 100;\n                        } else {\n                            color_value = ((cur - layer_min) / (layer_max-layer_min)) * 100;\n                        }\n                        // use the color value to get color if mode === spectrum or threshold || get opacity if mode === opacity\n                        // set color or opacity for the endpoint (e.opacity, e.color)\n                        // use these values in the single tube layer\n                        let mode = self.panel.color.mode;\n                        var popColor;\n                        var popOpacity;\n                        if(mode === 'spectrum'){\n                            popColor =self.scale.getColor(color_value);\n                            e.endpointColor = popColor;\n                            e.endpointOpacity = 1;\n                        }else if(mode === 'opacity'){\n                            popColor = self.panel.color.cardColor;\n                            popOpacity = self.scale.getOpacity(color_value, self.opacity);\n                            e.endpointColor = popColor;\n                            e.endpointOpacity = popOpacity;\n                        }else if(mode === 'threshold'){\n                            popColor = self.scale.getThresholdColor(color_value, self.t_colors, self.panel.legend.thresholds);\n                            e.endpointColor = popColor;\n                            e.endpointOpacity = 1;\n                        }\n                    });\n                }\n\n                // updating link information with the calculated values\n                // set line color for the lines based on these values\n\n                _.forEach(target_links, function(obj){\n                    let layer_max = layer.max();\n                    let layer_min = layer.min();\n                    let color_criteria = self.panel.layer.link.selected;\n                    var l = obj.link\n                    l.count = count;\n                    avg = sum/count;\n                    let color_value;\n                    if(color_criteria === \"Average\") {\n                        color_value = ((avg - layer_min) / (layer_max-layer_min)) * 100;\n                    } else if(color_criteria === \"Minimum\") {\n                        color_value = ((min - layer_min) / (layer_max-layer_min)) * 100;\n                    } else if(color_criteria === \"Maximum\") {\n                        color_value = ((max - layer_min) / (layer_max-layer_min)) * 100;\n                    } else {\n                        color_value = ((cur - layer_min) / (layer_max-layer_min)) * 100;\n                    }\n\n                    // if mode === spectrum, set the line color based on % value\n                    // else if mode === opacity, set the line color with the card color and opacity based on % value\n                    // create a new property for links - l.lineOpacity\n                    // apply opacity to circuits in the single tube layer.\n                    let mode = self.panel.color.mode;\n                    var lineColor;\n                    var lineOpacity;\n                    if(mode === 'spectrum'){\n                        lineColor =self.scale.getColor(color_value);\n                        l.lineColor = lineColor;\n                        l.lineOpacity = 1;\n                    }else if(mode === 'opacity'){\n                        lineColor = self.panel.color.cardColor;\n                        lineOpacity = self.scale.getOpacity(color_value, self.opacity);\n                        l.lineColor = lineColor;\n                        l.lineOpacity = lineOpacity;\n                    }else if(mode === 'threshold'){\n                        lineColor = self.scale.getThresholdColor(color_value, self.t_colors, self.panel.legend.thresholds);\n                        l.lineColor = lineColor;\n                        l.lineOpacity = 1;\n                    }\n\n                    //check for AZ or ZA based on the endpoint the data was found at!\n                    if(l.endpoints[0].name === obj.endpoint){\n                        l.az.name = l.endpoints[0].name;\n                        if(l.endpoints[0].label) l.az.label = l.endpoints[0].label;\n                        l.az.cur = color_value;\n                        l.azLineColor = lineColor;\n                        l.azLineOpacity = lineOpacity;\n                        l.az.max = self.toSI(max);\n                        l.az.min = self.toSI(min);\n                        l.az.sum = self.toSI(sum);\n                        l.az.avg = self.toSI(avg);\n                        l.az.now = self.toSI(cur);\n                        if (self.panel.arrows) l.arrow = 1\n                        else l.arrow = 0;\n                    } else{\n                        l.za.name = l.endpoints[1].name;\n                        if(l.endpoints[1].label) l.za.label = l.endpoints[1].label;\n                        l.za.cur = color_value;\n                        l.zaLineColor = lineColor;\n                        l.zaLineOpacity = lineOpacity;\n                        l.za.max = self.toSI(max);\n                        l.za.min = self.toSI(min);\n                        l.za.sum = self.toSI(sum);\n                        l.za.avg = self.toSI(sum / count);\n                        l.za.now = self.toSI(cur);\n                        if (self.panel.arrows) l.arrow = 2\n                        else l.arrow = 0;\n                    }\n\t\t            if(!self.panel.twin_tubes){\n                        if(l.az.cur != null && l.za.cur != null){\n                            if(l.az.cur > l.za.cur){\n                                l.lineColor = l.azLineColor;\n                                l.lineOpacity = l.azLineOpacity;\n                                l.arrow = 1;\n                            } else{\n                                l.lineColor = l.zaLineColor;\n                                l.lineOpacity = l.zaLineOpacity;\n                                l.arrow = 2;\n                            }\n                        }\n                    }\n                });\n            });\n        });\n\n        _.forEach(this.panel.layers, function(layer){\n            if(typeof layer.active !== \"function\"){\n                return;\n            }\n            layer.update();\n        });\n    }\n\n    toSI(num){\n        if(this.panel.to_si === 0){\n            num = num / panelDefaults.to_si;\n        } else{\n            num = num / this.panel.to_si;\n        }\n        return num.toFixed(2);\n    }\n\n    onDataError(err) {\n        this.dataRaw = [];\n    }\n\n    onInitEditMode() {\n        this.addEditorTab('Options', 'public/plugins/globalnoc-networkmap-panel/editor.html', 2);\n        this.addEditorTab('Display', 'public/plugins/globalnoc-networkmap-panel/display_editor.html', 3);\n        tempArray=this.scale.displayColor(this.panel.colorScheme);\n    }\n\n    onInitPanelActions(actions) {\n         this.render();\n    }\n\n    onOpacityLegendColor(color){\n        this.panel.color.cardColor = color;\n        this.render();\n    }\n\n    onThresholdColorChange(index) {\n        return color => {\n            this.panel.threshold_colors[index] = color;\n            this.render();\n        }\n    }\n\n    onDownLinkChange(color) {\n        this.panel.downLinkColor = color;\n        this.scale.setDownLinkColor(color);\n        this.render();\n    }\n\n    onDefaultNodeColor(color) {\n        this.panel.nodeFillColor = color;\n        this.render();\n    }\n\n    updateThresholdDefaults() {\n        console.log(this.panel.legend.thresholds);\n        if(!this.panel.threshold_colors[0]) {\n            this.panel.threshold_colors[0] = \"rgb(200,200,200)\";\n        }\n        this.panel.legend.thresholds.forEach((threshold,idx) => {\n            if(!this.panel.threshold_colors[idx+1]) {\n                this.panel.threshold_colors[idx+1] = \"rgb(200,200,200)\";\n            }\n        });\n    }\n\n    jsonModal(){\n        var modalScope = this.$scope.$new(false);\n        modalScope.panel = this.panel;\n        appEvents.emit('show-modal', {\n            src: 'public/plugins/globalnoc-networkmap-panel/json_editor.html',\n            scope: modalScope,\n        });\n    }\n\n    addNewChoice() {\n        var num = this.panel.choices.length + 1;\n        this.panel.choices.push(num);\n        this.layer_ids.push('');\n        this.panel.name.push('');\n        this.panel.mapSrc.push('');\n        this.panel.max.push('');\n        this.panel.min.push('');\n        //not sure\n        this.panel.size.push('')\n    }\n\n    useValidator(index) {\n        this.jsonModal();\n        let json = this.panel.mapSrc[index];\n        let json_obj;\n        try{\n            json_obj = JSON.parse(json);\n            this.json_content = JSON.stringify(json_obj, undefined, 2);\n        }catch(e){\n            this.json_content = json;\n        }\n        this.json_index = index;\n    }\n\n    saveToMapSrc(index){\n        if(index===null) return;\n        this.panel.mapSrc[index] = this.json_content;\n        this.render();\n    }\n\n    removeChoice(index) {\n        this.panel.choices.splice(index,1);\n        if(this.layer_ids[index]){\n           $(\"#\"+this.layer_ids[index]).remove();\n        }\n        this.layer_ids.splice(index,1);\n        this.panel.name.splice(index,1);\n        this.panel.mapSrc.splice(index,1);\n        this.panel.max.splice(index,1);\n        this.panel.min.splice(index,1);\n\t//Not sure\n\tthis.panel.size.splice(index,1)\n    }\n\n    display() {\n        this.colors=this.scale.displayColor(this.panel.colorScheme);\n        this.rgb_values = this.colors.rgb_values;\n        this.hex_values = this.colors.hex_values;\n        if(this.panel.legend.invert){\n            _.reverse(this.hex_values);\n            _.reverse(this.rgb_values);\n        }\n    }\n\n    displayOpacity(options, legendWidth){\n        this.opacity = this.scale.getOpacityScale(options, legendWidth);\n        if(this.panel.legend.invert){\n            _.reverse(this.opacity);\n        }\n    }\n\n    isSorted(arr){\n        let original = arr.toString();\n        arr.sort(function(a,b){\n            return a-b;\n        });\n        return arr.toString() === original;\n    }\n\n    displayThresholds(){\n        this.t_colors = this.scale.getThresholdScale(this.panel.legend.thresholds, this.panel.threshold_colors);\n        return this.t_colors;\n    }\n\n    getState(){\n        this.show_legend = this.panel.legend.show;\n    }\n\n    getHtml(htmlContent){\n        return this.custom_hover.parseHtml(htmlContent);\n    }\n\n    isJson(str){\n        try{\n            JSON.parse(str)\n        }catch(e){\n            return false;\n        }\n        return true;\n    }\n\n    link(scope, elem, attrs, ctrl){\n        var self = this;\n        let firstRender = true;\n\n        ctrl.events.on('render', function() {\n            render();\n            ctrl.renderingCompleted();\n        });\n\n        function render() {\n            window.onbeforeunload = null;\n            if (!ctrl.recentData){\n                return;\n            }\n\n            // delay first render\n            if (firstRender) {\n                firstRender = false;\n                setTimeout(render, 100);\n                return;\n            }\n\n            ctrl.panel.legend.adjLoadLegend = {\n                horizontal: true,\n            }\n\n            let zoom = ctrl.panel.zoom;\n            let html_content = ctrl.getHtml(ctrl.panel.tooltip.content);\n            ctrl.panel.tooltip.content = html_content;\n            let node_content = ctrl.getHtml(ctrl.panel.tooltip.node_content);\n            ctrl.panel.tooltip.node_content = node_content;\n            if(ctrl.map_drawn == true){\n\n                if(ctrl.panel.color.mode === 'opacity'){\n                    ctrl.displayOpacity(ctrl.panel.color, ctrl.map.width()*0.4);\n                    ctrl.panel.legend.mode = ctrl.panel.color.mode;\n                    ctrl.panel.legend.opacity = ctrl.opacity;\n                    ctrl.panel.legend.card_color = ctrl.panel.color.cardColor;\n                } else if (ctrl.panel.color.mode === 'spectrum'){\n                    ctrl.display();\n                    ctrl.panel.legend.mode = ctrl.panel.color.mode;\n                    ctrl.panel.legend.legend_colors = ctrl.hex_values;\n                } else if(ctrl.panel.color.mode === 'threshold'){\n                    ctrl.panel.legend.mode = ctrl.panel.color.mode;\n                    if(ctrl.isSorted(ctrl.panel.legend.thresholds)){\n                        let colors = ctrl.displayThresholds();\n                        ctrl.panel.legend.legend_colors = colors;\n                    }else {\n                        ctrl.t_colors = [];\n                        ctrl.panel.legend.thresholds = [];\n                        ctrl.panel.legend.legend_colors = [];\n                    }\n                }\n\n                ctrl.map.drawLegend(ctrl.panel.legend);\n                ctrl.map.validateSize();\n                if(!ctrl.panel.use_image) {\n                    zoom = ctrl.panel.zoom;\n                    if(zoom > 18){\n                        zoom = 18;\n                    }else if(zoom < 1){\n                        zoom = 1;\n                    }\n                    let latlng = [ctrl.panel.lat, ctrl.panel.lng];\n                    ctrl.map.setMapUrl(ctrl.panel.map_tile_url);\n                    ctrl.map.zoom({zoom});\n                    ctrl.map.panTo({latlng});\n                } else {\n                    zoom = ctrl.panel.zoom;\n                    if(zoom > 4){\n                        zoom = 4;\n                    }else if(zoom < 2){\n                        zoom = 2;\n                    }\n                    let latlng = [0, 0];\n                    ctrl.map.setImageUrl(ctrl.panel.image_url, zoom);\n                    ctrl.map.zoom({zoom});\n                    ctrl.map.panTo({latlng});\n                }\n\n                ctrl.map.toggleWeatherTile(ctrl.panel.weather_tile)\n\n                // Remove existing layers from DOM and the  map before adding new layers.\n                let all_layers = ctrl.layer_ids;\n                _.forEach(all_layers, function(layer){\n                    if(layer!==''){\n                        $(\"#\"+layer).remove();\n                        ctrl.map.removeLayers(layer);\n                    }\n                });\n\n                ctrl.layer_ids = [];\n                ctrl.panel.layers = [];\n                for(let j=0; j<ctrl.panel.choices.length;j++){\n                    if(ctrl.panel.mapSrc[j] === null || ctrl.panel.mapSrc[j] === undefined) {\n                        return;\n                    }\n\n                    let networkLayer = ctrl.map.addNetworkLayer({\n                        name: ctrl.panel.name[j],\n                        max: ctrl.panel.max[j],\n                        min: ctrl.panel.min[j],\n                        lineWidth: ctrl.panel.size[j],\n                        twin_tubes: ctrl.panel.twin_tubes,\n                        mapSource: ctrl.panel.mapSrc[j],\n                        endpointColor : ctrl.panel.nodeFillColor,\n                        node_content: node_content,\n                        static_node_tooltip: ctrl.panel.static_node_tooltip\n                    });\n\n                    if(ctrl.panel.mapSrc[j] === null || ctrl.panel.mapSrc[j] === undefined || ctrl.panel.mapSrc[j] === \"\") {\n                        ctrl.layer_ids.push('');\n                        continue;\n                    }\n                    ctrl.layer_ids.push(networkLayer.layerId());\n                    ctrl.panel.layers.push(networkLayer);\n                    networkLayer.onInitComplete(function() {\n                        ctrl.process_data(self.recentData);\n                    });\n                    if(ctrl.isJson(ctrl.panel.mapSrc[j])){\n                        ctrl.process_data(self.recentData);\n                    }\n                }\n                return;\n            }\n\n            if(!document.getElementById('container_map_' + ctrl.panel.id)){\n                console.log(\"Container not found\");\n            }\n\n            if(!ctrl.panel.use_image){\n                zoom = ctrl.panel.zoom;\n                if(zoom > 18){\n                    zoom = 18;\n                }else if(zoom <= 2){\n                    zoom = 2;\n                }\n                let map = LeafletMap({ containerId: ctrl.containerDivId,\n                    bing_api_key: ctrl.panel.bing_api_key,\n                    map_tile_url: ctrl.panel.map_tile_url,\n                    image: ctrl.panel.use_image,\n                    lat: ctrl.panel.lat,\n                    lng: ctrl.panel.lng,\n                    zoom: zoom,\n                    twin_tubes: ctrl.panel.twin_tubes,\n                    tooltip: ctrl.panel.tooltip,\n                    weather_tile: ctrl.panel.weather_tile,\n                    node_content: node_content\n                });\n                ctrl.map = map;\n            } else {\n                zoom = ctrl.panel.zoom;\n                if(zoom > 4){\n                    zoom = 4;\n                }else if(zoom <= 2){\n                    zoom = 2;\n                }\n                let map = LeafletMap({ containerId: ctrl.containerDivId,\n                    map_tile_url: ctrl.panel.map_tile_url,\n                    image: ctrl.panel.use_image,\n                    image_url: ctrl.panel.image_url,\n                    lat: 45,\n                    lng: -90,\n                    zoom: zoom,\n                    twin_tubes: ctrl.panel.twin_tubes,\n                    tooltip: ctrl.panel.tooltip\n                });\n                ctrl.map = map;\n            }\n            ctrl.map_drawn = true;\n            if(ctrl.panel.color.mode === 'opacity'){\n                ctrl.displayOpacity(ctrl.panel.color, ctrl.map.width() * 0.4);\n                ctrl.panel.legend.mode = ctrl.panel.color.mode;\n                ctrl.panel.legend.opacity = ctrl.opacity;\n                ctrl.panel.legend.card_color = ctrl.panel.color.cardColor;\n            } else if(ctrl.panel.color.mode === 'spectrum'){\n                ctrl.display();\n                ctrl.panel.legend.mode = ctrl.panel.color.mode;\n                ctrl.panel.legend.legend_colors = ctrl.hex_values;\n            } else if(ctrl.panel.color.mode === 'threshold'){\n                ctrl.panel.legend.mode = ctrl.panel.color.mode;\n                if(ctrl.isSorted(ctrl.panel.legend.thresholds)){\n                    let colors = ctrl.displayThresholds();\n                    ctrl.panel.legend.legend_colors = colors;\n                }else {\n                    ctrl.t_colors = [];\n                    ctrl.panel.legend.thresholds = []\n                    ctrl.panel.legend.legend_colors = [];\n                }\n            }\n\n            if(ctrl.panel.legend.show){\n                ctrl.map.drawLegend(ctrl.panel.legend);\n            }\n\n            if(ctrl.map === undefined){\n                return;\n            }\n\n            for(let i=0; i < ctrl.panel.choices.length; i++){\n                if(ctrl.panel.mapSrc[i] === null || ctrl.panel.mapSrc[i] === undefined){\n                    return;\n                }\n                let networkLayer = ctrl.map.addNetworkLayer({\n                    name: ctrl.panel.name[i],\n                    max: ctrl.panel.max[i],\n                    min: ctrl.panel.min[i],\n                    twin_tubes: ctrl.panel.twin_tubes,\n                    lineWidth: ctrl.panel.size[i],\n                    mapSource: ctrl.panel.mapSrc[i],\n                    endpointColor : ctrl.panel.nodeFillColor,\n                    static_node_tooltip: ctrl.panel.static_node_tooltip \n                });\n                ctrl.layer_ids.push(networkLayer.layerId());\n                ctrl.panel.layers.push(networkLayer);\n                networkLayer.onInitComplete(function(){\n                    ctrl.process_data(self.recentData);\n                });\n                if(ctrl.isJson(ctrl.panel.mapSrc[i])){\n                    ctrl.process_data(self.recentData);\n                }\n            }\n            ctrl.map.validateSize();\n        }\n    }\n}\n\nAtlas3.templateUrl = 'module.html';\n\n"]}